# [项目名称] - 部署文档

---

## 文档信息

| 项目 | 内容 |
|------|------|
| **项目名称** | [项目名称] |
| **文档版本** | v1.0 |
| **创建日期** | YYYY-MM-DD |
| **最后更新** | YYYY-MM-DD |
| **部署环境** | [生产/测试/开发] |
| **服务器系统** | [操作系统及版本] |

---

## 目录

1. [部署架构](#1-部署架构)
2. [服务器配置](#2-服务器配置)
3. [环境准备](#3-环境准备)
4. [数据库部署](#4-数据库部署)
5. [后端部署](#5-后端部署)
6. [前端部署](#6-前端部署)
7. [Nginx配置](#7-nginx配置)
8. [域名配置](#8-域名配置)
9. [SSL证书配置](#9-ssl证书配置)
10. [监控与日志](#10-监控与日志)
11. [备份策略](#11-备份策略)
12. [常见问题](#12-常见问题)

---

## 1. 部署架构

### 1.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                          用户访问层                              │
├─────────────────────────┬───────────────────────────────────────┤
│  [前端用户]              │  [后台用户]                           │
└────────────┬────────────┴────────────┬──────────────────────────┘
             │                         │
             │ HTTPS                   │ HTTPS
             ↓                         ↓
┌─────────────────────────────────────────────────────────────────┐
│                     CDN层（[CDN服务商]）                         │
│  - 静态资源加速                                                  │
│  - 全国节点分发                                                  │
│  - 自动HTTPS                                                     │
└────────────┬────────────────────────┬──────────────────────────┘
             │                         │
             │ 回源                    │ 回源
             ↓                         ↓
┌─────────────────────────────────────────────────────────────────┐
│                   [服务器配置]                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                     [Web服务器]                           │  │
│  │  - 域名路由分发                                           │  │
│  │  - 静态资源服务                                           │  │
│  │  - API请求转发                                            │  │
│  └────────────┬─────────────────────┬───────────────────────┘  │
│               │                     │                           │
│               ↓                     ↓                           │
│  ┌─────────────────────┐  ┌─────────────────────────────────┐  │
│  │  前端静态文件        │  │  后端服务                        │  │
│  │  [部署路径]          │  │  [运行方式]                      │  │
│  ├─────────────────────┤  │  ─────────────────────────────  │  │
│  │ [前端项目1]          │  │  路由前缀区分：                  │  │
│  │ [部署路径1]          │  │  [路由1]  → [说明]              │  │
│  │                     │  │  [路由2]  → [说明]              │  │
│  │ [前端项目2]          │  │                                  │  │
│  │ [部署路径2]          │  │  ┌──────────────┐              │  │
│  └─────────────────────┘  │  │ [模块1]       │              │  │
│                            │  └──────────────┘              │  │
│                            │  ┌──────────────┐              │  │
│                            │  │ [模块2]       │              │  │
│                            │  └──────────────┘              │  │
│                            │                                  │  │
│                            │  ┌────────────────────────────┐│  │
│                            │  │ [缓存方案]                  ││  │
│                            │  │ - [缓存项1]                 ││  │
│                            │  │ - [缓存项2]                 ││  │
│                            │  └────────────────────────────┘│  │
│                            └──────────────────────────────────┘  │
└────────────────────────────┬────────────┬────────────┬──────────┘
                             │            │            │
                             ↓            ↓            ↓
              ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
              │  [数据库]        │  │  [文件存储]      │  │  [第三方服务]    │
              │  [配置说明]      │  │  [配置说明]      │  │  [配置说明]      │
              └─────────────────┘  └─────────────────┘  └─────────────────┘
```

### 1.2 域名规划

| 域名 | 用途 | 说明 |
|------|------|------|
| [域名1] | [用途] | [说明] |
| [域名2] | [用途] | [说明] |
| [域名3] | [用途] | [说明] |

### 1.3 端口规划

| 端口 | 服务 | 说明 |
|------|------|------|
| 80 | HTTP | 自动重定向到HTTPS |
| 443 | HTTPS | Web服务 |
| [端口1] | [服务] | [说明] |
| [端口2] | [服务] | [说明] |

---

## 2. 服务器配置

### 2.1 服务器要求

| 配置项 | 最低配置 | 推荐配置 | 说明 |
|--------|---------|---------|------|
| **CPU** | [配置] | [配置] | [说明] |
| **内存** | [配置] | [配置] | [说明] |
| **硬盘** | [配置] | [配置] | [说明] |
| **带宽** | [配置] | [配置] | [说明] |
| **操作系统** | [系统] | [系统] | [说明] |

### 2.2 服务器信息

| 项目 | 信息 |
|------|------|
| **服务商** | [服务商名称] |
| **地域** | [地域] |
| **实例规格** | [规格] |
| **公网IP** | [IP地址] |
| **内网IP** | [IP地址] |

---

## 3. 环境准备

### 3.1 系统更新

```bash
# 更新系统包
[更新命令]

# 安装基础工具
[安装命令]
```

### 3.2 安装[运行环境1]

```bash
# 安装[运行环境1]
[安装命令]

# 验证安装
[验证命令]
```

### 3.3 安装[运行环境2]

```bash
# 安装[运行环境2]
[安装命令]

# 验证安装
[验证命令]
```

### 3.4 安装[Web服务器]

```bash
# 安装[Web服务器]
[安装命令]

# 启动服务
[启动命令]

# 设置开机自启
[自启命令]

# 验证安装
[验证命令]
```

### 3.5 安装[其他依赖]

```bash
# 安装[依赖名称]
[安装命令]
```

---

## 4. 数据库部署

### 4.1 安装数据库

```bash
# 安装[数据库]
[安装命令]

# 启动数据库
[启动命令]

# 设置开机自启
[自启命令]
```

### 4.2 数据库配置

```bash
# 登录数据库
[登录命令]

# 创建数据库
[创建命令]

# 创建用户
[创建用户命令]

# 授权
[授权命令]

# 刷新权限
[刷新命令]
```

### 4.3 数据库安全配置

```bash
# 修改配置文件
[配置文件路径]

# 配置内容
[配置内容示例]

# 重启数据库
[重启命令]
```

### 4.4 导入初始数据

```bash
# 导入数据库结构
[导入命令]

# 导入初始数据
[导入命令]
```

---

## 5. 后端部署

### 5.1 创建项目目录

```bash
# 创建目录
mkdir -p [项目路径]
cd [项目路径]
```

### 5.2 上传代码

```bash
# 方式1：Git克隆
git clone [仓库地址]

# 方式2：FTP上传
# 使用FTP工具上传代码到服务器

# 方式3：SCP上传
scp -r [本地路径] [用户]@[服务器IP]:[远程路径]
```

### 5.3 创建虚拟环境（如适用）

```bash
# 创建虚拟环境
[创建命令]

# 激活虚拟环境
[激活命令]
```

### 5.4 安装依赖

```bash
# 安装依赖
[安装命令]
```

### 5.5 配置环境变量

```bash
# 创建环境变量文件
cat > .env << EOF
# 应用配置
APP_NAME=[应用名称]
APP_ENV=[环境]
DEBUG=[是否调试]

# 数据库配置
DATABASE_URL=[数据库连接URL]

# 其他配置
[配置项]=[值]
EOF
```

### 5.6 数据库迁移

```bash
# 执行数据库迁移
[迁移命令]
```

### 5.7 启动后端服务

#### **方式1：直接启动（测试用）**

```bash
# 启动服务
[启动命令]
```

#### **方式2：使用进程管理工具**

```bash
# 安装进程管理工具
[安装命令]

# 创建配置文件
cat > [配置文件路径] << EOF
[配置内容]
EOF

# 启动服务
[启动命令]

# 查看状态
[查看状态命令]

# 设置开机自启
[自启命令]
```

### 5.8 验证后端服务

```bash
# 测试API
curl [API地址]

# 查看日志
[查看日志命令]
```

---

## 6. 前端部署

### 6.1 本地构建

```bash
# 进入前端项目目录
cd [前端项目路径]

# 安装依赖
[安装命令]

# 构建生产版本
[构建命令]
```

### 6.2 上传构建文件

```bash
# 创建部署目录
mkdir -p [部署路径]

# 上传构建文件
scp -r [本地构建路径]/* [用户]@[服务器IP]:[部署路径]

# 或使用FTP工具上传
```

### 6.3 设置文件权限

```bash
# 设置所有者
chown -R [用户]:[用户组] [部署路径]

# 设置权限
chmod -R 755 [部署路径]
```

---

## 7. Nginx配置

### 7.1 创建配置文件

```bash
# 创建站点配置
cat > [配置文件路径] << 'EOF'
[配置内容]
EOF
```

### 7.2 [前端项目1]配置

```nginx
server {
    listen 80;
    server_name [域名];
    
    # 重定向到HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name [域名];
    
    # SSL证书配置
    ssl_certificate [证书路径];
    ssl_certificate_key [密钥路径];
    
    # SSL优化配置
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers [加密套件];
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    
    # 根目录
    root [部署路径];
    index index.html;
    
    # Gzip压缩
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    gzip_min_length 1000;
    
    # 静态资源缓存
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|woff|woff2|ttf|eot)$ {
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
    
    # SPA路由支持
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 日志配置
    access_log [日志路径];
    error_log [日志路径];
}
```

### 7.3 [后端API]配置

```nginx
server {
    listen 80;
    server_name [API域名];
    
    # 重定向到HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name [API域名];
    
    # SSL证书配置
    ssl_certificate [证书路径];
    ssl_certificate_key [密钥路径];
    
    # 请求体大小限制
    client_max_body_size [大小];
    
    # 代理配置
    location / {
        proxy_pass http://[后端地址];
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 超时配置
        proxy_connect_timeout [时间];
        proxy_send_timeout [时间];
        proxy_read_timeout [时间];
    }
    
    # 日志配置
    access_log [日志路径];
    error_log [日志路径];
}
```

### 7.4 测试并重载配置

```bash
# 测试配置
[测试命令]

# 重载配置
[重载命令]
```

---

## 8. 域名配置

### 8.1 DNS解析配置

| 记录类型 | 主机记录 | 记录值 | TTL |
|---------|---------|--------|-----|
| A | [主机记录] | [服务器IP] | 600 |
| A | [主机记录] | [服务器IP] | 600 |
| CNAME | [主机记录] | [CDN域名] | 600 |

### 8.2 验证DNS解析

```bash
# 查询DNS解析
nslookup [域名]

# 或使用dig命令
dig [域名]
```

---

## 9. SSL证书配置

### 9.1 申请SSL证书

#### **方式1：免费证书（Let's Encrypt）**

```bash
# 安装certbot
[安装命令]

# 申请证书
[申请命令]

# 自动续期
[续期命令]
```

#### **方式2：购买证书**

1. 在证书服务商购买证书
2. 下载证书文件
3. 上传到服务器

### 9.2 配置证书

```bash
# 创建证书目录
mkdir -p [证书目录]

# 上传证书文件
# [证书文件].pem
# [密钥文件].key

# 设置权限
chmod 600 [证书目录]/*
```

### 9.3 验证证书

```bash
# 在线验证
# 访问 https://[域名]

# 命令行验证
openssl s_client -connect [域名]:443 -servername [域名]
```

---

## 10. 监控与日志

### 10.1 日志配置

#### **应用日志**

```bash
# 日志目录
[日志目录路径]

# 日志文件
[日志文件列表]
```

#### **Nginx日志**

```bash
# 访问日志
[访问日志路径]

# 错误日志
[错误日志路径]
```

### 10.2 日志查看

```bash
# 实时查看日志
tail -f [日志文件]

# 查看最后N行
tail -n [行数] [日志文件]

# 搜索日志
grep "[关键词]" [日志文件]
```

### 10.3 日志轮转

```bash
# 创建日志轮转配置
cat > [配置文件路径] << EOF
[配置内容]
EOF
```

### 10.4 监控指标

| 监控项 | 命令 | 说明 |
|--------|------|------|
| **CPU使用率** | [命令] | [说明] |
| **内存使用率** | [命令] | [说明] |
| **磁盘使用率** | [命令] | [说明] |
| **网络流量** | [命令] | [说明] |
| **进程状态** | [命令] | [说明] |

---

## 11. 备份策略

### 11.1 数据库备份

#### **手动备份**

```bash
# 备份数据库
[备份命令]
```

#### **自动备份**

```bash
# 创建备份脚本
cat > [脚本路径] << 'EOF'
[脚本内容]
EOF

# 设置执行权限
chmod +x [脚本路径]

# 添加定时任务
crontab -e
# 添加：[定时表达式] [脚本路径]
```

### 11.2 代码备份

```bash
# 备份代码
[备份命令]
```

### 11.3 配置文件备份

```bash
# 备份配置文件
[备份命令]
```

### 11.4 备份恢复

```bash
# 恢复数据库
[恢复命令]

# 恢复代码
[恢复命令]

# 恢复配置
[恢复命令]
```

---

## 12. 常见问题

### 12.1 服务无法启动

**问题描述：** [问题描述]

**解决方案：**
1. [步骤1]
2. [步骤2]
3. [步骤N]

### 12.2 数据库连接失败

**问题描述：** [问题描述]

**解决方案：**
1. [步骤1]
2. [步骤2]
3. [步骤N]

### 12.3 静态资源404

**问题描述：** [问题描述]

**解决方案：**
1. [步骤1]
2. [步骤2]
3. [步骤N]

### 12.4 SSL证书错误

**问题描述：** [问题描述]

**解决方案：**
1. [步骤1]
2. [步骤2]
3. [步骤N]

### 12.5 性能问题

**问题描述：** [问题描述]

**解决方案：**
1. [步骤1]
2. [步骤2]
3. [步骤N]

---

## 13. 运维命令速查

### 13.1 服务管理

```bash
# 启动服务
[启动命令]

# 停止服务
[停止命令]

# 重启服务
[重启命令]

# 查看状态
[查看状态命令]
```

### 13.2 日志查看

```bash
# 查看应用日志
[查看命令]

# 查看Nginx日志
[查看命令]

# 查看系统日志
[查看命令]
```

### 13.3 性能监控

```bash
# 查看CPU
[查看命令]

# 查看内存
[查看命令]

# 查看磁盘
[查看命令]

# 查看网络
[查看命令]
```

---

## 14. 更新部署

### 14.1 后端更新

```bash
# 1. 备份当前版本
[备份命令]

# 2. 拉取最新代码
[更新命令]

# 3. 安装依赖（如有变更）
[安装命令]

# 4. 数据库迁移（如有变更）
[迁移命令]

# 5. 重启服务
[重启命令]

# 6. 验证服务
[验证命令]
```

### 14.2 前端更新

```bash
# 1. 本地构建新版本
[构建命令]

# 2. 备份当前版本
[备份命令]

# 3. 上传新版本
[上传命令]

# 4. 清理CDN缓存（如使用CDN）
[清理命令]

# 5. 验证访问
[验证命令]
```

---

## 15. 安全加固

### 15.1 防火墙配置

```bash
# 配置防火墙规则
[配置命令]
```

### 15.2 SSH安全配置

```bash
# 修改SSH配置
[配置命令]
```

### 15.3 定期更新

```bash
# 更新系统包
[更新命令]

# 更新安全补丁
[更新命令]
```

---

**文档维护：** [维护团队/负责人]  
**最后更新：** YYYY-MM-DD