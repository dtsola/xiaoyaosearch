# 架构决策 - 国际化(i18n)实施方案

**决策日期**：2025年12月29日

## 背景

小遥搜索作为一款面向知识工作者、内容创作者和技术开发者的桌面应用，需要支持国际化以扩大用户基础。当前应用所有界面文本和API消息均为中文，限制了产品的国际化推广。

为满足以下需求，需要实施完整的国际化方案：
1. 支持中文和英文双语切换
2. 为后续扩展更多语言奠定基础
3. 提升用户体验，满足国际化用户需求
4. 符合桌面应用的国际化最佳实践

## 解决方案

### 技术选型

**前端国际化**
- 采用 `vue-i18n@9` 作为国际化框架（Vue3官方方案）
- 集成 Ant Design Vue 内置语言包
- 语言包存储格式：JSON文件
- 支持组件级语言切换和全局语言状态管理

**后端国际化**
- 自定义轻量级i18n模块（基于FastAPI）
- 语言包存储格式：JSON文件
- 通过 `Accept-Language` 请求头传递语言设置
- 支持依赖注入方式获取当前语言

**目录结构**
```
frontend/src/renderer/src/
├── locales/                 # 前端语言包目录
│   ├── zh-CN.ts            # 简体中文
│   ├── en-US.ts            # 英文
│   └── index.ts            # 导出配置
├── i18n/
│   ├── config.ts           # i18n配置
│   └── setup.ts            # 初始化设置

backend/
├── app/
│   ├── core/
│   │   └── i18n.py         # i18n核心模块
│   └── locales/            # 后端语言包目录
│       ├── zh_CN.json      # 简体中文
│       ├── en_US.json      # 英文
│       └── __init__.py
```

### 实施细节

**1. 语言包存储方式**
- ✅ 使用JSON文件存储所有翻译文本
- ✅ 前端使用TypeScript模块导出（增强类型安全）
- ✅ 后端使用纯JSON文件（易于编辑和维护）
- ✅ 支持嵌套键结构（如 `common.success`）

**2. 语言切换方式**
- ✅ 手动切换：用户在设置页面选择语言
- ✅ 语言选择持久化到localStorage
- ✅ 应用启动时自动加载上次选择的语言
- ❌ 不使用自动检测（避免频繁切换）

**3. 默认语言**
- ✅ 默认语言：简体中文（zh-CN/zh_CN）
- ✅ 首次使用时显示中文界面
- ✅ 找不到翻译时回退到中文

**4. 翻译范围**
- ✅ 前端所有UI组件文本（约150条）
- ✅ 后端API响应消息（约100条）
- ✅ 错误提示和验证消息（约80条）
- ✅ 帮助文档和README（约170条）
- ✅ **总计：约500+条翻译**

**5. 前后端语言同步**
- ✅ 前端通过Axios拦截器自动添加 `Accept-Language` 请求头
- ✅ 后端从请求头读取语言设置
- ✅ 后端响应使用与请求一致的语言
- ✅ 统一语言代码格式（zh-CN/zh_CN）

### 核心实现

**前端i18n配置**
```typescript
// 使用vue-i18n@9组合式API模式
// 支持全局注入$t函数
// 集成Ant Design Vue语言包
// 支持dayjs日期国际化
```

**后端i18n模块**
```python
# 自定义I18N类
# 支持点号分隔的嵌套键访问
# 支持参数格式化（如 "找到 {count} 个结果"）
# 使用LRU缓存优化性能
# 从请求头自动获取语言设置
```

### 实施计划

| 阶段 | 任务 | 工作量 | 里程碑 |
|------|------|--------|--------|
| 阶段一 | 基础架构搭建 | 1-2天 | 前后端i18n框架就绪 |
| 阶段二 | 语言包编写 | 2-3天 | 完成中英文翻译 |
| 阶段三 | 前端改造 | 3-4天 | 所有组件支持国际化 |
| 阶段四 | 后端改造 | 2-3天 | 所有API支持国际化 |
| 阶段五 | 测试与优化 | 1-2天 | 完成全面测试 |
| **总计** | **完整实施** | **9-14天** | **国际化功能上线** |

## 影响

### 技术影响

**依赖变更**
- 前端新增依赖：`vue-i18n@9`
- 后端无新增依赖（使用标准库json模块）

**代码变更**
- 前端：需要修改8个Vue组件，将硬编码文本替换为 `$t()` 函数调用
- 后端：需要修改33个API接口，将硬编码消息替换为 `i18n.t()` 调用
- 新增语言包文件：约4个文件（前端2个，后端2个）

**性能影响**
- 前端：i18n框架轻量级，对性能影响可忽略（按需加载语言包）
- 后端：使用LRU缓存翻译结果，性能影响极小

### 兼容性影响

**向后兼容**
- ✅ 现有API保持兼容（默认返回中文）
- ✅ 现有数据库结构无需变更
- ✅ 现有配置文件无需修改

**用户体验影响**
- ✅ 中文用户无感知（默认语言）
- ✅ 英文用户获得完整英文体验
- ✅ 语言切换即时生效，无需重启应用

### 维护影响

**新增维护工作**
1. 新增功能时需要同步更新中英文翻译
2. 术语翻译需要保持一致性
3. 定期审核翻译质量

**维护建议**
1. 建立翻译术语表，统一专业术语翻译
2. 使用代码审查确保新增代码包含翻译
3. 定期收集用户反馈优化翻译质量

### 扩展性影响

**未来可扩展支持**
- ✅ 其他语言（日语、韩语、法语等）
- ✅ 地区化差异（简体中文/繁体中文）
- ✅ RTL语言（阿拉伯语等，需要额外布局调整）
- ✅ 动态语言包加载（减少应用体积）

**扩展路径**
1. 添加新的语言包文件（如 ja-JP.ts、ko-KR.ts）
2. 更新语言选择器UI
3. 无需修改核心代码

---

**决策编号**：AD-20251229-01

**决策状态**：✅ 已批准

**决策者**：项目负责人

**实施期限**：2025年1月12日（2周内完成）